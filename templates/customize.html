<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ¨ ë¼ë¦¬ ê¾¸ë¯¸ê¸°</title>
  <style>
    :root {
      --bg: #eaf6ff;
      --card: #ffffff;
      --blue: #89c9f5;
      --blue-2: #58aafc;
      --shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    body {
      background: var(--bg);
      font-family: "Noto Sans KR", sans-serif;
      text-align: center;
      margin: 0;
      padding: 40px 0;
    }

    h2 {
      color: #333;
      margin-bottom: 20px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      background: #d6eaff;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }

    .tab-btn.active {
      background: var(--blue-2);
      color: white;
    }

    .content {
      display: none;
      animation: fade .3s ease;
    }

    .content.active { display: block; }

    @keyframes fade {
      from {opacity:0; transform: translateY(8px);}
      to {opacity:1; transform: translateY(0);}
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 20px;
      justify-items: center;
      margin-top: 30px;
    }

    .option {
      width: 110px;
      border-radius: 20px;
      background: var(--card);
      box-shadow: var(--shadow);
      padding: 10px;
      transition: transform .2s;
    }

    .option:hover { transform: scale(1.07); }

    .option img {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      object-fit: cover;
    }

    .option button {
      margin-top: 10px;
      border: none;
      background: none;
      font-size: 1.6em;
      cursor: pointer;
      transition: .2s;
    }

    .option button:hover { transform: scale(1.2); }

    .selected {
      border: 3px solid var(--blue-2);
      background: #e9f6ff;
    }

    .back-btn {
      margin-top: 40px;
      background: var(--blue-2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: .2s;
    }

    .back-btn:hover { filter: brightness(0.95); }
  </style>
</head>
<body>
  <h2>ğŸ¨ ë¼ë¦¬ ê¾¸ë¯¸ê¸°</h2>

  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('avatar')">ì•„ë°”íƒ€ ğŸ‘¤</button>
    <button class="tab-btn" onclick="switchTab('mascot')">ë§ˆìŠ¤ì½”íŠ¸ ğŸ¤–</button>
  </div>

  <!-- âœ… ì•„ë°”íƒ€ íƒ­ -->
  <div id="avatar" class="content active">
    <p>ë‚´ í”„ë¡œí•„ ì•„ë°”íƒ€ ì„ íƒ ğŸ‘‡</p>
    <div class="grid">
      {% set avas = ["ava1.png", "ava2.png", "ava3.png", "ava4.png"] %}
      {% for a in avas %}
      <div class="option" id="ava{{ loop.index }}">
        <img src="{{ url_for('static', filename='avatars/' + a) }}" alt="{{ a }}">
        <button onclick="selectAvatar('{{ url_for('static', filename='avatars/' + a) }}')">
          {{ ["ğŸ˜€","ğŸ˜","ğŸ§¸","ğŸ§‘â€ğŸ“"][loop.index0] }}
        </button>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- âœ… ë§ˆìŠ¤ì½”íŠ¸ íƒ­ -->
  <div id="mascot" class="content">
    <p>ë¼ë¦¬(ë´‡) ë§ˆìŠ¤ì½”íŠ¸ ì„ íƒ ğŸ‘‡</p>
    <form method="POST">
      <div class="grid">
        {% set emojis = ["ğŸ°","ğŸ¦Š","ğŸ»","ğŸ±","ğŸ¶","ğŸ¹","ğŸ¼","ğŸ§"] %}
        {% for m in mascots %}
        <div class="option {% if current_user.mascot == m %}selected{% endif %}">
          <img src="{{ url_for('static', filename='mascot/' + m) }}" alt="{{ m }}">
          <button type="submit" name="mascot" value="{{ m }}">{{ emojis[loop.index0] }}</button>
        </div>
        {% endfor %}
      </div>
    </form>
  </div>

  <button class="back-btn" onclick="location.href='/'">â¬… ëŒì•„ê°€ê¸°</button>

  <script>
    // âœ… íƒ­ ì „í™˜
    function switchTab(tab){
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".content").forEach(c => c.classList.remove("active"));
      document.querySelector(`.tab-btn[onclick*='${tab}']`).classList.add("active");
      document.getElementById(tab).classList.add("active");
    }

    // âœ… ì•„ë°”íƒ€ ì„ íƒ ì €ì¥ (localStorage)
    function selectAvatar(path){
      localStorage.setItem("userAvatar", path);
      document.querySelectorAll("#avatar .option").forEach(o => o.classList.remove("selected"));
      const sel = [...document.querySelectorAll("#avatar img")].find(i => i.src.endsWith(path.split("/").pop()));
      if (sel) sel.parentElement.classList.add("selected");
      alert("ë‚´ ì•„ë°”íƒ€ê°€ ë°”ë€Œì—ˆì–´! ğŸ¨\nì±„íŒ…ì°½ì— ë°˜ì˜ë¼.");
    }
  </script>
</body>
</html>
